# MRS Design System Rules

## Overview

This document defines the rules and patterns for integrating Figma designs with the MRS Material-UI v7.2.0 design system using the Model Context Protocol (MCP). These rules ensure consistency between design and implementation.

---

## 1. Token Definitions

### Location
- **Primary Source**: `/Users/mader/mrs-ui/theme.json`
- **Format**: JSON (Material-UI v7.2.0 compatible)
- **Structure**: Hierarchical with color schemes, typography, spacing, shape, and component tokens

### Token Structure

```json
{
  "colorSchemes": {
    "light": { /* light theme tokens */ },
    "dark": { /* dark theme tokens */ }
  },
  "typography": { /* typography scale */ },
  "shape": { /* border radius values */ },
  "spacing": [ /* spacing scale array */ ],
  "components": { /* component-specific overrides */ }
}
```

### Token Categories

#### Colors
- **Location**: `theme.json > colorSchemes.{light|dark} > palette`
- **Structure**: 
  - Semantic colors: `primary`, `secondary`, `error`, `warning`, `info`, `success`
  - Each color has: `main`, `dark`, `light`, `contrastText`
  - State tokens: `_states.hover`, `_states.selected`, `_states.focus`, etc.
  - Component-specific: `_components.{componentName}`

#### Typography
- **Location**: `theme.json > typography`
- **Font Family**: `Nunito, Helvetica, Arial, sans-serif` (primary)
- **Scale**: `h1`, `h2`, `h3`, `h4`, `h5`, `h6`, `body1`, `body2`, `subtitle1`, `subtitle2`, `overline`, `caption`

#### Spacing
- **Location**: `theme.json > spacing`
- **Format**: Array `[0, 4, 8, 12, 16, 24, 32, 40, 48, 56, 64, 72, 80, 88, 96]`
- **Unit**: Pixels (px)
- **Usage**: Access via index (e.g., `spacing[1]` = 4px)

#### Shape (Border Radius)
- **Location**: `theme.json > shape`
- **Values**: `sm: 4`, `md: 8`, `lg: 12`, `xl: 24`, `rounded: 9999`

### Token Naming Conventions

1. **Color Tokens**: Use semantic naming
   - ✅ `palette.primary.main`
   - ✅ `palette.error._states.hover`
   - ❌ `palette.color1` or `palette.blue500`

2. **Component Tokens**: Use component name prefix
   - ✅ `_components.alert.error.filled.background`
   - ❌ `alertBackgroundColor`

3. **State Tokens**: Use `_states` prefix
   - ✅ `palette.primary._states.hover`
   - ✅ `palette.primary._states.focusVisible`

### Token Transformation

- **Current**: Direct JSON consumption
- **Future Consideration**: Style Dictionary for multi-platform output
- **CSS Variables**: Material-UI generates CSS variables automatically (e.g., `var(--mui-palette-primary-main)`)

---

## 2. Component Library

### Current Status
- **Components**: Not yet implemented
- **Architecture**: To be determined (Atomic Design recommended)
- **Framework**: Material-UI (MUI) v7.2.0

### Component Structure (Recommended)

```
src/
  components/
    atoms/
      Button/
        Button.tsx
        Button.test.tsx
        Button.stories.tsx
        index.ts
    molecules/
      Alert/
        Alert.tsx
        Alert.test.tsx
        Alert.stories.tsx
        index.ts
    organisms/
      Header/
        Header.tsx
        Header.test.tsx
        Header.stories.tsx
        index.ts
```

### Component Patterns

#### Component File Structure
```typescript
// Button.tsx
import { Button as MuiButton, ButtonProps } from '@mui/material';
import { useTheme } from '@mui/material/styles';

export interface CustomButtonProps extends ButtonProps {
  // Custom props here
}

export const Button = ({ ...props }: CustomButtonProps) => {
  const theme = useTheme();
  
  return (
    <MuiButton
      {...props}
      sx={{
        // Use theme tokens
        backgroundColor: theme.palette.primary.main,
        borderRadius: theme.shape.rounded,
        padding: theme.spacing(1, 2),
      }}
    />
  );
};
```

#### Token Consumption Pattern
- **Always use theme tokens** from `theme.json`
- **Access via Material-UI theme**: `theme.palette.primary.main`
- **Use spacing function**: `theme.spacing(2)` (multiplies by 8px base)
- **Use shape values**: `theme.shape.md`

---

## 3. Frameworks & Libraries

### Core Stack
- **UI Framework**: Material-UI (MUI) v7.2.0
- **Language**: TypeScript
- **Styling**: Material-UI's `sx` prop + theme system
- **Build System**: To be configured (Vite recommended)

### Dependencies (Expected)
```json
{
  "dependencies": {
    "@mui/material": "^7.2.0",
    "@mui/icons-material": "^7.2.0",
    "react": "^18.0.0",
    "react-dom": "^18.0.0"
  },
  "devDependencies": {
    "typescript": "^5.0.0",
    "@types/react": "^18.0.0"
  }
}
```

### Styling Approach
- **Primary**: Material-UI `sx` prop for component-level styles
- **Theme**: Centralized in `theme.json`
- **CSS Variables**: Auto-generated by MUI from theme
- **No CSS Modules**: Use MUI's styling system

---

## 4. Asset Management

### Current Status
- **Assets**: Not yet configured
- **Recommended Location**: `src/assets/`

### Recommended Structure
```
src/
  assets/
    images/
      logos/
      illustrations/
    icons/
      (if custom icons needed)
    fonts/
      (if custom fonts needed)
```

### Asset Guidelines
- **Images**: Use optimized formats (WebP, AVIF)
- **Icons**: Prefer Material-UI icons (`@mui/icons-material`)
- **Fonts**: Nunito (load via Google Fonts or self-hosted)

---

## 5. Icon System

### Primary Source
- **Library**: `@mui/icons-material`
- **Usage**: Import directly from MUI
```typescript
import { Home, Settings, Person } from '@mui/icons-material';
```

### Custom Icons
- **Location**: `src/assets/icons/` (if needed)
- **Format**: SVG
- **Naming**: PascalCase (e.g., `CustomIcon.svg`)
- **Component Wrapper**: Create React component wrapping SVG

### Icon Token Integration
- **Color**: Use `theme.palette.icon.primary`
- **Size**: Use standard MUI sizes (`small`, `medium`, `large`)

---

## 6. Styling Approach

### Methodology
- **CSS-in-JS**: Material-UI's `sx` prop
- **Theme-based**: All styles reference `theme.json`
- **No Global CSS**: Use MUI's theme system

### Responsive Design
- **Breakpoints**: Use MUI breakpoints (`xs`, `sm`, `md`, `lg`, `xl`)
- **Implementation**: Via `sx` prop or `useMediaQuery` hook
```typescript
<Box
  sx={{
    width: { xs: '100%', md: '50%' },
    padding: { xs: 2, md: 4 }
  }}
/>
```

### State Styles
- **Hover**: `theme.palette.{color}._states.hover`
- **Focus**: `theme.palette.{color}._states.focus`
- **Selected**: `theme.palette.{color}._states.selected`
- **Disabled**: `theme.palette.action.disabled`

---

## 7. Project Structure

### Current Structure
```
/Users/mader/mrs-ui/
  theme.json
```

### Recommended Structure
```
/Users/mader/mrs-ui/
  src/
    components/
      atoms/
      molecules/
      organisms/
    tokens/
      (if token transformation needed)
    utils/
    assets/
  theme.json
  package.json
  tsconfig.json
  vite.config.ts (or build config)
```

### File Naming Conventions
- **Components**: PascalCase (`Button.tsx`)
- **Utilities**: camelCase (`formatDate.ts`)
- **Constants**: UPPER_SNAKE_CASE (`API_ENDPOINTS.ts`)
- **Types**: PascalCase (`ButtonProps.ts`)

---

## 8. Figma Integration Guidelines

### Design-to-Code Mapping

#### Colors
- **Figma Variable** → **Theme Token**
- Example: `Primary/500` → `theme.palette.primary.main`
- Use Figma MCP to extract color tokens and map to theme structure

#### Typography
- **Figma Text Style** → **Theme Typography Scale**
- Example: `Heading 1` → `theme.typography.h1`
- Verify font family matches (`Nunito`)

#### Spacing
- **Figma Spacing** → **Theme Spacing Array**
- Example: `16px` → `theme.spacing(2)` (index-based)
- Round to nearest spacing value

#### Components
- **Figma Component** → **React Component**
- Extract component props from Figma variants
- Map Figma states to component props

### Figma MCP Workflow

1. **Extract Design Context**
   ```typescript
   // Use Figma MCP get_design_context
   // Extract node structure, styles, and tokens
   ```

2. **Map to Theme Tokens**
   - Compare Figma tokens with `theme.json`
   - Identify missing tokens
   - Update `theme.json` if needed

3. **Generate Component Code**
   - Use extracted design context
   - Apply theme tokens
   - Follow component patterns

4. **Validate Consistency**
   - Compare visual output with Figma design
   - Verify token usage
   - Check responsive behavior

### Node ID Extraction
- **Format**: `11225-362624` → `11225:362624` (for MCP)
- **Usage**: Extract from Figma URL `node-id` parameter

---

## 9. Component Development Rules

### Component Creation Checklist

1. ✅ **Check theme.json** for existing tokens
2. ✅ **Extract design from Figma** using MCP
3. ✅ **Map Figma tokens** to theme tokens
4. ✅ **Create component** following structure
5. ✅ **Use theme tokens** exclusively (no hardcoded values)
6. ✅ **Add TypeScript types** for props
7. ✅ **Test component** with light/dark themes
8. ✅ **Document usage** in Storybook (if configured)

### Token Usage Rules

- ✅ **DO**: Use `theme.palette.primary.main`
- ❌ **DON'T**: Use `"#00686F"` (hardcoded color)

- ✅ **DO**: Use `theme.spacing(2)`
- ❌ **DON'T**: Use `"16px"` (hardcoded spacing)

- ✅ **DO**: Use `theme.shape.md`
- ❌ **DON'T**: Use `"8px"` (hardcoded border radius)

### Component Props

- **Extend MUI props** when possible
- **Add custom props** only when necessary
- **Document all props** with JSDoc comments
- **Provide default values** for optional props

---

## 10. Theme Customization

### Adding New Tokens

1. **Update theme.json** with new token
2. **Follow naming conventions**
3. **Add to both light and dark** color schemes if color-related
4. **Document token purpose** in comments

### Token Hierarchy

```
theme.json
  ├── colorSchemes
  │   ├── light
  │   │   └── palette
  │   │       ├── primary
  │   │       ├── secondary
  │   │       └── _components
  │   └── dark
  │       └── palette (same structure)
  ├── typography
  ├── shape
  ├── spacing
  └── components (MUI overrides)
```

---

## 11. Quality Assurance

### Design Consistency Checks

- [ ] All colors match Figma design
- [ ] Typography scale matches design system
- [ ] Spacing follows 4px grid system
- [ ] Border radius uses shape tokens
- [ ] Component states (hover, focus) implemented
- [ ] Dark mode support verified
- [ ] Responsive behavior matches design

### Code Quality Checks

- [ ] TypeScript types defined
- [ ] No hardcoded values (use tokens)
- [ ] Components follow naming conventions
- [ ] Props properly documented
- [ ] Accessibility attributes included (ARIA)

---

## 12. Documentation Standards

### Component Documentation

Each component should include:
- **Purpose**: What the component does
- **Props**: All available props with types
- **Usage Examples**: Code examples
- **Design Tokens**: Which tokens are used
- **Variants**: Available variants and states

### Token Documentation

Document in `theme.json` comments or separate docs:
- **Token purpose**: Why the token exists
- **Usage guidelines**: When to use
- **Related tokens**: Connections to other tokens

---

## 13. Version Control

### Theme Versioning
- **Format**: Semantic versioning (e.g., `7.2.0`)
- **Breaking changes**: Update major version
- **New tokens**: Update minor version
- **Bug fixes**: Update patch version

### Changelog
- Document all token changes
- Note component additions/modifications
- Track Figma design updates

---

## 14. Figma MCP Integration Examples

### Extracting Component Design

```typescript
// Example: Extract Button component from Figma
// Node ID: 11225:362624
const designContext = await getDesignContext({
  nodeId: "11225:362624",
  clientLanguages: "typescript",
  clientFrameworks: "react"
});

// Map to component structure
const buttonProps = {
  variant: designContext.variant, // "contained", "outlined", etc.
  color: mapColorToTheme(designContext.color), // Map to theme.palette
  size: designContext.size, // "small", "medium", "large"
};
```

### Extracting Tokens

```typescript
// Extract variable definitions
const variables = await getVariableDefs({
  nodeId: "11225:362624"
});

// Map Figma variables to theme.json structure
const themeTokens = mapFigmaToTheme(variables);
```

---

## 15. Common Patterns

### Button Component Pattern
```typescript
import { Button as MuiButton, ButtonProps } from '@mui/material';
import { useTheme } from '@mui/material/styles';

export const Button = (props: ButtonProps) => {
  const theme = useTheme();
  return <MuiButton {...props} />;
};
```

### Alert Component Pattern
```typescript
import { Alert as MuiAlert, AlertProps } from '@mui/material';
import { useTheme } from '@mui/material/styles';

export const Alert = ({ severity, variant, ...props }: AlertProps) => {
  const theme = useTheme();
  const alertTokens = theme.palette._components.alert[severity][variant];
  
  return (
    <MuiAlert
      severity={severity}
      variant={variant}
      sx={{
        backgroundColor: alertTokens.background,
        color: alertTokens.foreground,
      }}
      {...props}
    />
  );
};
```

---

## 16. Troubleshooting

### Common Issues

#### Token Not Found
- **Problem**: Token doesn't exist in theme.json
- **Solution**: Add token to theme.json following naming conventions

#### Color Mismatch
- **Problem**: Component color doesn't match Figma
- **Solution**: Verify token mapping, check color scheme (light/dark)

#### Spacing Inconsistency
- **Problem**: Spacing doesn't match design
- **Solution**: Use spacing array index, verify 4px grid alignment

---

## 17. Future Considerations

### Planned Enhancements
- [ ] Style Dictionary integration for token transformation
- [ ] Storybook documentation setup
- [ ] Automated Figma → Code sync
- [ ] Component testing suite
- [ ] Design token validation
- [ ] Multi-platform token output (iOS, Android)

---

## 18. References

### Figma File
- **URL**: `https://www.figma.com/design/c4weC6RhdEd7c8B1GkCjTB/MRS---Material-UI-v.7.2.0`
- **Node ID Format**: `11225:362624` (for MCP)

### Material-UI Documentation
- **Theme**: https://mui.com/material-ui/customization/theming/
- **Components**: https://mui.com/material-ui/getting-started/
- **v7.2.0**: Latest version compatibility

---

## 19. Quick Reference

### Token Access Patterns
```typescript
// Colors
theme.palette.primary.main
theme.palette.error._states.hover

// Typography
theme.typography.h1
theme.typography.body1

// Spacing
theme.spacing(2) // 16px (index 4 in array)

// Shape
theme.shape.md // 8px

// Component tokens
theme.palette._components.alert.error.filled.background
```

### Figma MCP Tools
- `get_design_context`: Extract component design
- `get_variable_defs`: Extract design tokens
- `get_screenshot`: Visual reference
- `create_design_system_rules`: Generate this file

---

**Last Updated**: December 2025  
**Version**: 1.0.0  
**Maintained By**: Design System Team
